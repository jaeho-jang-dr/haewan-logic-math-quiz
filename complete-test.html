<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>논리수학 퀴즈 - 완전 테스트</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
        }
        
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-width: 400px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 9999;
        }
        
        .debug-log {
            margin: 5px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .debug-error {
            background: rgba(255, 0, 0, 0.3);
        }
        
        .debug-success {
            background: rgba(0, 255, 0, 0.3);
        }
        
        .touch-button {
            min-height: 44px;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            touch-action: manipulation;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .iphone-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin: 10px;
            overflow: hidden;
        }
        
        .animate-bounceIn {
            animation: bounceIn 0.6s ease-out;
        }
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .animate-ping {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
                transform: translate3d(0, 0, 0);
            }
            40%, 43% {
                animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
                transform: translate3d(0, -30px, 0);
            }
            70% {
                animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
                transform: translate3d(0, -15px, 0);
            }
            90% {
                transform: translate3d(0, -4px, 0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="debug-panel" class="debug-panel">
        <h3 style="margin: 0 0 10px 0;">🐛 Complete Debug Panel</h3>
        <button onclick="testScoreSubmission()" class="touch-button" style="margin: 5px; background: #4CAF50; color: white;">테스트: 점수 제출</button>
        <button onclick="testLeaderboard()" class="touch-button" style="margin: 5px; background: #2196F3; color: white;">테스트: 리더보드</button>
        <button onclick="testFanfare()" class="touch-button" style="margin: 5px; background: #FF9800; color: white;">테스트: 팡파레</button>
        <button onclick="clearDatabase()" class="touch-button" style="margin: 5px; background: #f44336; color: white;">DB 초기화</button>
        <div id="debug-logs"></div>
    </div>
    
    <!-- 데이터베이스 -->
    <script src="js/database.js"></script>
    
    <!-- 테스트용 문제 데이터 -->
    <script>
        // 디버그 로그 함수
        window.debugLog = function(message, type = 'info') {
            const logs = document.getElementById('debug-logs');
            const log = document.createElement('div');
            log.className = `debug-log ${type === 'error' ? 'debug-error' : type === 'success' ? 'debug-success' : ''}`;
            log.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(log);
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        };
        
        // console 오버라이드
        const originalLog = console.log;
        const originalError = console.error;
        console.log = function(...args) {
            originalLog(...args);
            window.debugLog(args.join(' '), 'info');
        };
        console.error = function(...args) {
            originalError(...args);
            window.debugLog(args.join(' '), 'error');
        };
        
        // 테스트용 간단한 문제
        window.easyQuestions = [
            {
                id: 'test1',
                question: '테스트 문제 1: 1 + 1 = ?',
                steps: [
                    { step: '1단계', correct: '2', options: ['1', '2', '3', '4'] },
                    { step: '2단계', correct: '2', options: ['1', '2', '3', '4'] },
                    { step: '3단계', correct: '2', options: ['1', '2', '3', '4'] }
                ]
            },
            {
                id: 'test2',
                question: '테스트 문제 2: 2 + 2 = ?',
                steps: [
                    { step: '1단계', correct: '4', options: ['1', '2', '3', '4'] },
                    { step: '2단계', correct: '4', options: ['1', '2', '3', '4'] },
                    { step: '3단계', correct: '4', options: ['1', '2', '3', '4'] }
                ]
            },
            {
                id: 'test3',
                question: '테스트 문제 3: 3 + 3 = ?',
                steps: [
                    { step: '1단계', correct: '6', options: ['4', '5', '6', '7'] },
                    { step: '2단계', correct: '6', options: ['4', '5', '6', '7'] },
                    { step: '3단계', correct: '6', options: ['4', '5', '6', '7'] }
                ]
            }
        ];
        
        window.mediumQuestions = window.easyQuestions;
        window.hardQuestions = window.easyQuestions;
        
        // 보물 데이터
        window.treasuresDatabase = [
            { id: 'treasure1', name: '황금 보물', emoji: '💎', brand: '전설의', category: '보물' },
            { id: 'treasure2', name: '은빛 트로피', emoji: '🏆', brand: '명예의', category: '상품' },
            { id: 'treasure3', name: '신비한 선물', emoji: '🎁', brand: '마법의', category: '선물' }
        ];
        
        // 테스트 함수들
        window.testScoreSubmission = async function() {
            debugLog('점수 제출 테스트 시작...', 'info');
            try {
                const db = new MathQuizDatabase();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 테스트 사용자 생성
                const userId = await db.addUser('테스트유저', 'elementary3-4');
                debugLog(`사용자 생성 완료: ID=${userId}`, 'success');
                
                // 세션 생성
                const sessionId = await db.createSession(userId, 'easy');
                debugLog(`세션 생성 완료: ID=${sessionId}`, 'success');
                
                // 점수 추가
                await db.addScore(sessionId, 100, {
                    answers: [],
                    completedAt: Date.now(),
                    difficulty: 'easy'
                });
                debugLog('점수 추가 완료: 100점', 'success');
                
                // 확인
                const scores = await db.getTopScores(10);
                debugLog(`리더보드 확인: ${scores.length}개 점수`, 'success');
                debugLog(JSON.stringify(scores, null, 2), 'info');
                
            } catch (error) {
                debugLog(`에러: ${error.message}`, 'error');
            }
        };
        
        window.testLeaderboard = async function() {
            debugLog('리더보드 테스트 시작...', 'info');
            try {
                const db = new MathQuizDatabase();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const scores = await db.getTopScores(25);
                debugLog(`현재 점수 개수: ${scores.length}`, 'info');
                
                if (typeof window.LeaderboardSystem !== 'undefined') {
                    debugLog('LeaderboardSystem 발견!', 'success');
                    const leaderboard = new window.LeaderboardSystem();
                    const rankings = leaderboard.getRankings();
                    debugLog(`가상 플레이어 수: ${rankings.length}`, 'info');
                } else {
                    debugLog('LeaderboardSystem을 찾을 수 없습니다!', 'error');
                }
            } catch (error) {
                debugLog(`에러: ${error.message}`, 'error');
            }
        };
        
        window.testFanfare = function() {
            debugLog('팡파레 테스트 시작...', 'info');
            // 실제 앱에서 팡파레를 트리거하는 상태 설정
            if (window.testSetShowFanfare) {
                window.testSetShowFanfare(true);
                window.testSetFanfareTreasure(window.treasuresDatabase[0]);
                debugLog('팡파레 표시 요청 완료', 'success');
            } else {
                debugLog('팡파레 함수를 찾을 수 없습니다!', 'error');
            }
        };
        
        window.clearDatabase = async function() {
            if (confirm('정말로 데이터베이스를 초기화하시겠습니까?')) {
                const dbName = 'MathQuizDB';
                indexedDB.deleteDatabase(dbName);
                debugLog('데이터베이스 초기화 완료', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        };
    </script>
    
    <!-- 플레이어 데이터 -->
    <script src="data/players/players-db.js"></script>
    
    <!-- 컴포넌트 -->
    <script src="components/scoreboard-complete.js"></script>
    <script src="components/admin-complete.js"></script>
    <script src="components/treasure-collection.js"></script>
    
    <!-- 메인 앱 -->
    <script src="app-complete.js"></script>
    
    <script>
        // 앱이 로드된 후 테스트 함수 연결
        setTimeout(() => {
            debugLog('Complete Test 페이지 로드 완료', 'success');
        }, 1000);
    </script>
</body>
</html>