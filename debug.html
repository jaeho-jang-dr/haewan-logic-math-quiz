<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ë²„ê·¸ - í˜œì™„ì´ì˜ ë…¼ë¦¬ìˆ˜í•™ í€´ì¦ˆ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .debug-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            overflow-y: auto;
            font-size: 12px;
            z-index: 1000;
        }
        .debug-item {
            margin: 10px 0;
            padding: 5px;
            border: 1px solid #333;
            border-radius: 3px;
        }
        .error { border-color: #ff4444; background: rgba(255,68,68,0.1); }
        .success { border-color: #44ff44; background: rgba(68,255,68,0.1); }
        .warning { border-color: #ffaa00; background: rgba(255,170,0,0.1); }
        .main-content { margin-right: 320px; }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h3>ğŸ› ë””ë²„ê·¸ íŒ¨ë„</h3>
        <div id="debug-log"></div>
        <button onclick="clearDebug()" style="background: #333; color: white; border: none; padding: 5px; margin-top: 10px; width: 100%;">
            ë¡œê·¸ ì§€ìš°ê¸°
        </button>
    </div>
    
    <div class="main-content">
        <div id="root"></div>
    </div>
    
    <!-- ì›ë˜ ìŠ¤í¬ë¦½íŠ¸ë“¤ -->
    <script src="js/database.js"></script>
    <script src="data/questions.js"></script>
    <script src="data/additional-questions.js"></script>
    
    <script>
        // ë””ë²„ê·¸ ë¡œê¹… ì‹œìŠ¤í…œ
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        const debugLog = document.getElementById('debug-log');
        
        function addDebugMessage(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug-item ${type}`;
            div.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong><br>
                <pre style="white-space: pre-wrap; font-family: monospace; font-size: 11px;">${message}</pre>
            `;
            debugLog.appendChild(div);
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        function clearDebug() {
            debugLog.innerHTML = '';
        }
        
        // ì½˜ì†” ì˜¤ë²„ë¼ì´ë“œ
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addDebugMessage(args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addDebugMessage(args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addDebugMessage(args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' '), 'warning');
        };
        
        // ì—ëŸ¬ ìºì¹˜
        window.addEventListener('error', function(e) {
            addDebugMessage(`ERROR: ${e.message}\nFile: ${e.filename}\nLine: ${e.lineno}:${e.colno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            addDebugMessage(`PROMISE REJECTION: ${e.reason}`, 'error');
        });
        
        // React ì—ëŸ¬ ê²½ê³„
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            
            static getDerivedStateFromError(error) {
                return { hasError: true, error: error };
            }
            
            componentDidCatch(error, errorInfo) {
                console.error('React Error Boundary:', error, errorInfo);
            }
            
            render() {
                if (this.state.hasError) {
                    return React.createElement('div', {
                        className: 'p-8 bg-red-100 border-2 border-red-500 rounded-lg m-4'
                    }, [
                        React.createElement('h2', { 
                            key: 'title',
                            className: 'text-2xl font-bold text-red-700 mb-4' 
                        }, 'ğŸš¨ React ì—ëŸ¬ ë°œìƒ'),
                        React.createElement('p', {
                            key: 'message',
                            className: 'text-red-600 mb-4'
                        }, 'ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'),
                        React.createElement('pre', {
                            key: 'error',
                            className: 'bg-red-50 p-4 rounded text-sm text-red-800 overflow-auto'
                        }, this.state.error?.toString() || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'),
                        React.createElement('button', {
                            key: 'reload',
                            onClick: () => window.location.reload(),
                            className: 'bg-red-500 text-white px-4 py-2 rounded mt-4'
                        }, 'í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨')
                    ]);
                }
                
                return this.props.children;
            }
        }
        
        addDebugMessage('ë””ë²„ê·¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        addDebugMessage('React: ' + (typeof React !== 'undefined' ? 'âœ…' : 'âŒ'), React ? 'success' : 'error');
        addDebugMessage('ReactDOM: ' + (typeof ReactDOM !== 'undefined' ? 'âœ…' : 'âŒ'), ReactDOM ? 'success' : 'error');
        addDebugMessage('Database: ' + (typeof MathQuizDatabase !== 'undefined' ? 'âœ…' : 'âŒ'), MathQuizDatabase ? 'success' : 'error');
        addDebugMessage('Questions: ' + (typeof questionsData !== 'undefined' ? 'âœ…' : 'âŒ'), questionsData ? 'success' : 'error');
    </script>
    
    <script type="text/babel">
        // ë””ë²„ê·¸ ë²„ì „ì˜ ì•±
        const { useState, useEffect } = React;
        
        function DebugApp() {
            const [status, setStatus] = useState('ì´ˆê¸°í™” ì¤‘...');
            const [database, setDatabase] = useState(null);
            const [testResults, setTestResults] = useState([]);
            
            useEffect(() => {
                runDebugTests();
            }, []);
            
            const runDebugTests = async () => {
                const results = [];
                
                try {
                    // í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ í™˜ê²½
                    console.log('í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ í™˜ê²½ ì²´í¬');
                    results.push({
                        name: 'ê¸°ë³¸ í™˜ê²½',
                        status: 'success',
                        message: 'ë¸Œë¼ìš°ì € í™˜ê²½ ì •ìƒ'
                    });
                    
                    // í…ŒìŠ¤íŠ¸ 2: React
                    console.log('í…ŒìŠ¤íŠ¸ 2: React ë¼ì´ë¸ŒëŸ¬ë¦¬ ì²´í¬');
                    if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined') {
                        results.push({
                            name: 'React ë¼ì´ë¸ŒëŸ¬ë¦¬',
                            status: 'success',
                            message: 'React ì •ìƒ ë¡œë“œë¨'
                        });
                    } else {
                        results.push({
                            name: 'React ë¼ì´ë¸ŒëŸ¬ë¦¬',
                            status: 'error',
                            message: 'React ë¡œë“œ ì‹¤íŒ¨'
                        });
                    }
                    
                    // í…ŒìŠ¤íŠ¸ 3: ë°ì´í„°ë² ì´ìŠ¤
                    console.log('í…ŒìŠ¤íŠ¸ 3: ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”');
                    if (typeof MathQuizDatabase !== 'undefined') {
                        try {
                            const db = new MathQuizDatabase();
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            setDatabase(db);
                            results.push({
                                name: 'ë°ì´í„°ë² ì´ìŠ¤',
                                status: 'success',
                                message: 'IndexedDB ì •ìƒ ì‘ë™'
                            });
                        } catch (error) {
                            results.push({
                                name: 'ë°ì´í„°ë² ì´ìŠ¤',
                                status: 'error',
                                message: 'DB ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message
                            });
                        }
                    } else {
                        results.push({
                            name: 'ë°ì´í„°ë² ì´ìŠ¤',
                            status: 'error',
                            message: 'MathQuizDatabase í´ë˜ìŠ¤ ì—†ìŒ'
                        });
                    }
                    
                    // í…ŒìŠ¤íŠ¸ 4: ë¬¸ì œ ë°ì´í„°
                    console.log('í…ŒìŠ¤íŠ¸ 4: ë¬¸ì œ ë°ì´í„° ì²´í¬');
                    if (typeof questionsData !== 'undefined') {
                        const easyCount = questionsData.easy?.length || 0;
                        const mediumCount = questionsData.medium?.length || 0;
                        const hardCount = questionsData.hard?.length || 0;
                        
                        results.push({
                            name: 'ë¬¸ì œ ë°ì´í„°',
                            status: 'success',
                            message: `ì‰¬ì›€: ${easyCount}ê°œ, ë³´í†µ: ${mediumCount}ê°œ, ì–´ë ¤ì›€: ${hardCount}ê°œ`
                        });
                    } else {
                        results.push({
                            name: 'ë¬¸ì œ ë°ì´í„°',
                            status: 'error',
                            message: 'questionsData ê°ì²´ ì—†ìŒ'
                        });
                    }
                    
                    setTestResults(results);
                    setStatus('í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                    
                } catch (error) {
                    console.error('ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                    setStatus('í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message);
                }
            };
            
            return React.createElement('div', {
                className: 'p-8 max-w-4xl mx-auto'
            }, [
                React.createElement('h1', {
                    key: 'title',
                    className: 'text-3xl font-bold mb-8 text-center'
                }, 'ğŸ› ë””ë²„ê·¸ ëª¨ë“œ'),
                
                React.createElement('div', {
                    key: 'status',
                    className: 'mb-8 p-4 bg-blue-100 rounded-lg'
                }, [
                    React.createElement('h2', {
                        key: 'status-title',
                        className: 'font-bold mb-2'
                    }, 'ìƒíƒœ'),
                    React.createElement('p', {
                        key: 'status-text'
                    }, status)
                ]),
                
                React.createElement('div', {
                    key: 'results',
                    className: 'space-y-4'
                }, testResults.map((result, index) => 
                    React.createElement('div', {
                        key: `result-${index}`,
                        className: `p-4 rounded-lg border-2 ${
                            result.status === 'success' 
                                ? 'bg-green-100 border-green-500' 
                                : 'bg-red-100 border-red-500'
                        }`
                    }, [
                        React.createElement('h3', {
                            key: 'result-title',
                            className: 'font-bold'
                        }, `${result.status === 'success' ? 'âœ…' : 'âŒ'} ${result.name}`),
                        React.createElement('p', {
                            key: 'result-message'
                        }, result.message)
                    ])
                )),
                
                React.createElement('div', {
                    key: 'actions',
                    className: 'mt-8 text-center space-x-4'
                }, [
                    React.createElement('button', {
                        key: 'retest-button',
                        onClick: runDebugTests,
                        className: 'bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600'
                    }, 'ğŸ”„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸'),
                    React.createElement('a', {
                        key: 'main-link',
                        href: 'index.html',
                        className: 'bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 inline-block'
                    }, 'ğŸ® ë©”ì¸ ê²Œì„ìœ¼ë¡œ')
                ])
            ]);
        }
        
        // ì—ëŸ¬ ê²½ê³„ë¡œ ê°ì‹¸ì„œ ë Œë”ë§
        ReactDOM.render(
            React.createElement(ErrorBoundary, null,
                React.createElement(DebugApp)
            ),
            document.getElementById('root')
        );
    </script>
</body>
</html>