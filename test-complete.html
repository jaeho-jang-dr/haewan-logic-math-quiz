<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>논리수학 퀴즈 - 완전 테스트</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        #test-results {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        #app-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 400px;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>논리수학 퀴즈 - 완전 테스트</h1>
    
    <div id="test-results">
        <h2>시스템 테스트 결과</h2>
        <div id="test-log"></div>
    </div>
    
    <div id="app-container">
        <div class="loading">
            <h3>애플리케이션 로딩 중...</h3>
            <p>이 메시지가 계속 보인다면 오류가 발생한 것입니다.</p>
        </div>
    </div>
    
    <div id="root" style="display:none;"></div>
    
    <script>
        // 테스트 로거
        const testLog = document.getElementById('test-log');
        let testCount = 0;
        let errorCount = 0;
        
        function log(message, type = 'info') {
            testCount++;
            if (type === 'error') errorCount++;
            
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            div.textContent = `[${testCount}] ${message}`;
            testLog.appendChild(div);
            console.log(`[TEST ${type.toUpperCase()}] ${message}`);
        }
        
        // 전역 오류 핸들러
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            log(`전역 오류: ${msg} (${url}:${lineNo}:${columnNo})`, 'error');
            return false;
        };
        
        // Promise 거부 핸들러
        window.addEventListener('unhandledrejection', function(event) {
            log(`Promise 거부: ${event.reason}`, 'error');
        });
        
        // 테스트 시작
        log('테스트 시작...', 'info');
        
        // 1. React 라이브러리 확인
        function checkLibraries() {
            log('라이브러리 확인 중...', 'info');
            
            if (typeof React === 'undefined') {
                log('React가 로드되지 않았습니다!', 'error');
                return false;
            }
            log('React 로드 완료 (v' + React.version + ')', 'success');
            
            if (typeof ReactDOM === 'undefined') {
                log('ReactDOM이 로드되지 않았습니다!', 'error');
                return false;
            }
            log('ReactDOM 로드 완료', 'success');
            
            if (typeof Babel === 'undefined') {
                log('Babel이 로드되지 않았습니다!', 'error');
                return false;
            }
            log('Babel 로드 완료', 'success');
            
            return true;
        }
        
        // 2. 스크립트 로더
        async function loadScript(src, name) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    log(`${name} 로드 완료`, 'success');
                    resolve();
                };
                script.onerror = () => {
                    log(`${name} 로드 실패: ${src}`, 'error');
                    reject(new Error(`Failed to load ${name}`));
                };
                document.head.appendChild(script);
            });
        }
        
        // 3. 애플리케이션 로드
        async function loadApplication() {
            try {
                log('애플리케이션 스크립트 로딩 시작...', 'info');
                
                // 데이터베이스
                await loadScript('js/database.js', 'Database');
                
                // 문제 데이터
                await loadScript('data/questions/easy-questions.js?v=' + Date.now(), 'Easy Questions');
                await loadScript('data/questions/medium-questions.js?v=' + Date.now(), 'Medium Questions');
                await loadScript('data/questions/hard-questions.js?v=' + Date.now(), 'Hard Questions');
                await loadScript('data/questions/easy-nature-questions.js?v=' + Date.now(), 'Easy Nature Questions');
                await loadScript('data/questions/medium-nature-questions.js?v=' + Date.now(), 'Medium Nature Questions');
                await loadScript('data/questions/hard-nature-questions.js?v=' + Date.now(), 'Hard Nature Questions');
                
                // 가전제품 데이터
                await loadScript('data/appliances/appliances-db.js?v=' + Date.now(), 'Appliances DB');
                await loadScript('data/appliances/appliances-enhanced.js?v=' + Date.now(), 'Appliances Enhanced');
                
                // 플레이어 데이터
                await loadScript('data/players/players-db.js?v=' + Date.now(), 'Players DB');
                
                // 컴포넌트
                await loadScript('components/scoreboard-complete.js?v=' + Date.now(), 'Scoreboard');
                await loadScript('components/admin-complete.js?v=' + Date.now(), 'Admin');
                await loadScript('components/appliance-collection.js?v=' + Date.now(), 'Appliance Collection');
                
                // 메인 앱 (마지막)
                await loadScript('app-complete.js?v=' + Date.now(), 'Main App');
                
                log('모든 스크립트 로드 완료!', 'success');
                
                // 데이터 확인
                checkGameData();
                
                // 앱 이동
                moveApp();
                
            } catch (error) {
                log(`애플리케이션 로드 실패: ${error.message}`, 'error');
            }
        }
        
        // 4. 게임 데이터 확인
        function checkGameData() {
            log('게임 데이터 확인 중...', 'info');
            
            // 문제 데이터
            const hasEasyQuestions = window.easyQuestions && window.easyQuestions.length > 0;
            const hasMediumQuestions = window.mediumQuestions && window.mediumQuestions.length > 0;
            const hasHardQuestions = window.hardQuestions && window.hardQuestions.length > 0;
            
            if (hasEasyQuestions) {
                log(`쉬운 문제: ${window.easyQuestions.length}개`, 'success');
            } else {
                log('쉬운 문제 데이터가 없습니다!', 'error');
            }
            
            if (hasMediumQuestions) {
                log(`중간 문제: ${window.mediumQuestions.length}개`, 'success');
            } else {
                log('중간 문제 데이터가 없습니다!', 'error');
            }
            
            if (hasHardQuestions) {
                log(`어려운 문제: ${window.hardQuestions.length}개`, 'success');
            } else {
                log('어려운 문제 데이터가 없습니다!', 'error');
            }
            
            // 가전제품 데이터
            if (window.appliancesDB && window.appliancesDB.length > 0) {
                log(`가전제품: ${window.appliancesDB.length}개`, 'success');
            } else {
                log('가전제품 데이터가 없습니다!', 'error');
            }
            
            // 컴포넌트 확인
            if (typeof window.ScoreboardComplete === 'function') {
                log('스코어보드 컴포넌트 확인됨', 'success');
            } else {
                log('스코어보드 컴포넌트를 찾을 수 없습니다!', 'error');
            }
            
            if (typeof window.AdminComplete === 'function') {
                log('관리자 컴포넌트 확인됨', 'success');
            } else {
                log('관리자 컴포넌트를 찾을 수 없습니다!', 'error');
            }
            
            if (typeof window.ApplianceCollection === 'function') {
                log('가전제품 컬렉션 컴포넌트 확인됨', 'success');
            } else {
                log('가전제품 컬렉션 컴포넌트를 찾을 수 없습니다!', 'error');
            }
        }
        
        // 5. 앱 이동
        function moveApp() {
            const rootDiv = document.getElementById('root');
            const appContainer = document.getElementById('app-container');
            
            if (rootDiv.children.length > 0) {
                log('React 앱이 성공적으로 렌더링되었습니다!', 'success');
                appContainer.innerHTML = '';
                appContainer.appendChild(rootDiv);
                rootDiv.style.display = 'block';
                
                // 최종 결과
                if (errorCount === 0) {
                    log(`\n✅ 테스트 완료! 모든 ${testCount}개 항목 통과`, 'success');
                } else {
                    log(`\n⚠️ 테스트 완료! ${errorCount}개 오류 발견`, 'warning');
                }
            } else {
                log('React 앱이 렌더링되지 않았습니다!', 'error');
                appContainer.innerHTML = '<div class="error" style="padding: 20px;">앱 렌더링 실패!</div>';
            }
        }
        
        // 테스트 실행
        window.addEventListener('load', async () => {
            log('페이지 로드 완료', 'info');
            
            // 잠시 대기 (React 등이 완전히 로드되도록)
            setTimeout(async () => {
                if (checkLibraries()) {
                    await loadApplication();
                } else {
                    log('라이브러리 로드 실패로 테스트 중단', 'error');
                }
            }, 1000);
        });
    </script>
</body>
</html>